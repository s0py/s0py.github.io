library(data.table)
library(ggplot2)
library(ggdist)

data <- data.table(Trump = c(199, 208, 218, 205, 215, 224, 234, 195, 205, 214, 224, 211, 221, 230, 240, 199, 209, 218, 228, 215, 225, 234, 244, 205, 215, 224, 234, 221, 231, 240, 250, 219, 229, 238, 248, 235, 245, 254, 264, 225, 235, 244, 254, 241, 251, 260, 270, 229, 239, 248, 258, 245, 255, 264, 274, 235, 245, 254, 264, 251, 261, 270, 280, 205, 215, 224, 234, 221, 231, 240, 250, 211, 221, 230, 240, 227, 237, 246, 256, 215, 225, 234, 244, 231, 241, 250, 260, 221, 231, 240, 250, 237, 247, 256, 266, 235, 245, 254, 264, 251, 261, 270, 280, 241, 251, 260, 270, 257, 267, 276, 286, 245, 255, 264, 274, 261, 271, 280, 290, 251, 261, 270, 280, 267, 277, 286, 296, 210, 219, 229, 216, 226, 235, 245, 206, 216, 225, 235, 222, 232, 241, 251, 210, 220, 229, 239, 226, 236, 245, 255, 216, 226, 235, 245, 232, 242, 251, 261, 230, 240, 249, 259, 246, 256, 265, 275, 236, 246, 255, 265, 252, 262, 271, 281, 240, 250, 259, 269, 256, 266, 275, 285, 246, 256, 265, 275, 262, 272, 281, 291, 216, 226, 235, 245, 232, 242, 251, 261, 222, 232, 241, 251, 238, 248, 257, 267, 226, 236, 245, 255, 242, 252, 261, 271, 232, 242, 251, 261, 248, 258, 267, 277, 246, 256, 265, 275, 262, 272, 281, 291, 252, 262, 271, 281, 268, 278, 287, 297, 256, 266, 275, 285, 272, 282, 291, 301, 262, 272, 281, 291, 278, 288, 297, 307))
data$Biden <- 538 - data$Trump
data$category <- fifelse(data$Biden > 270, "Biden Win", "Trump Win")
data$Likelihood <- c(9.83045E-08, 8.80448E-07, 1.47316E-06, 6.73694E-07, 1.12722E-06, 1.00958E-05, 1.68922E-05, 3.73754E-07, 6.25364E-07, 5.60097E-06, 9.37152E-06, 4.2857E-06, 7.17082E-06, 6.42243E-05, 0.00010746, 1.14867E-07, 1.92195E-07, 1.72136E-06, 2.88017E-06, 1.31714E-06, 2.20382E-06, 1.97382E-05, 3.30259E-05, 7.30725E-07, 1.22265E-06, 1.09504E-05, 1.83222E-05, 8.37896E-06, 1.40196E-05, 0.000125565, 0.000210094, 9.55766E-07, 1.59918E-06, 1.43228E-05, 2.39649E-05, 1.09594E-05, 1.83373E-05, 0.000164235, 0.000274797, 6.08011E-06, 1.01732E-05, 9.11147E-05, 0.000152453, 6.97184E-05, 0.000116652, 0.001044778, 0.001748119, 1.86861E-06, 3.12655E-06, 2.80025E-05, 4.68536E-05, 2.14267E-05, 3.58511E-05, 0.000321094, 0.000537253, 1.18872E-05, 1.98896E-05, 0.000178138, 0.000298059, 0.000136306, 0.000228067, 0.00204264, 0.003417737, 4.31228E-07, 7.21528E-07, 6.46225E-06, 1.08126E-05, 4.94473E-06, 8.2735E-06, 7.41002E-05, 0.000123984, 2.74326E-06, 4.59E-06, 4.11096E-05, 6.87844E-05, 3.14559E-05, 5.26319E-05, 0.000471389, 0.000788726, 8.43091E-07, 1.41066E-06, 1.26343E-05, 2.11397E-05, 9.66741E-06, 1.61755E-05, 0.000144873, 0.000242401, 5.36332E-06, 8.97389E-06, 8.03731E-05, 0.00013448, 6.14992E-05, 0.0001029, 0.000921609, 0.001542033, 7.01506E-06, 1.17376E-05, 0.000105126, 0.000175896, 8.04391E-05, 0.00013459, 0.001205437, 0.002016932, 4.46263E-05, 7.46686E-05, 0.000668757, 0.001118961, 0.000511714, 0.000856197, 0.007668387, 0.012830712, 1.37151E-05, 2.29481E-05, 0.00020553, 0.000343893, 0.000157266, 0.000263137, 0.002356742, 0.003943291, 8.72487E-05, 0.000145984, 0.001307482, 0.002187674, 0.001000448, 0.001673946, 0.014992418, 0.025085251, 9.0426E-07, 8.09886E-06, 1.3551E-05, 6.19701E-06, 1.03688E-05, 9.28666E-05, 0.000155384, 3.438E-06, 5.75245E-06, 5.15209E-05, 8.62045E-05, 3.94223E-05, 6.59613E-05, 0.000590771, 0.000988476, 1.05661E-06, 1.76791E-06, 1.5834E-05, 2.64934E-05, 1.21157E-05, 2.0272E-05, 0.000181563, 0.00030379, 6.72162E-06, 1.12466E-05, 0.000100728, 0.000168538, 7.70743E-05, 0.00012896, 0.001155013, 0.001932563, 8.79167E-06, 1.47102E-05, 0.000131749, 0.000220442, 0.000100811, 0.000168676, 0.001510722, 0.002527733, 5.59282E-05, 9.35789E-05, 0.000838124, 0.001402345, 0.000641309, 0.001073035, 0.009610457, 0.016080176, 1.71885E-05, 2.87598E-05, 0.000257582, 0.000430986, 0.000197095, 0.000329778, 0.002953603, 0.004941956, 0.000109345, 0.000182956, 0.001638611, 0.002741717, 0.001253819, 0.002097884, 0.018789349, 0.031438259, 3.96667E-06, 6.63702E-06, 5.94434E-05, 9.94604E-05, 4.54844E-05, 7.61043E-05, 0.000681615, 0.001140476, 2.5234E-05, 4.22214E-05, 0.000378149, 0.000632718, 0.000289349, 0.000484138, 0.004336097, 0.00725514, 7.75522E-06, 1.2976E-05, 0.000116217, 0.000194454, 8.89263E-05, 0.000148791, 0.001332622, 0.002229738, 4.93348E-05, 8.25469E-05, 0.000739317, 0.001237022, 0.000565705, 0.000946534, 0.008477479, 0.014184482, 6.45285E-05, 0.000107969, 0.000967004, 0.001617987, 0.000739924, 0.001238038, 0.011088283, 0.018552867, 0.000410498, 0.000686843, 0.006151598, 0.010292828, 0.004707029, 0.007875781, 0.070538123, 0.118024088, 0.000126159, 0.000211089, 0.001890584, 0.003163318, 0.001446622, 0.002420481, 0.021678637, 0.036272603, 0.000802562, 0.001342843, 0.012026954, 0.020123449, 0.009202685, 0.015397893, 0.137908673, 0.230748206)
  
  
dt <- dcast(data, Biden~., sum, value.var = "Likelihood")
colnames(dt) <- c("Biden Electoral Votes", "Relative Likelihood")
dt$`Relative Likelihood` <- dt$`Relative Likelihood`
dt$category <- fifelse(dt$`Biden Electoral Votes` > 270, "Biden Win", "Trump Win")

ggplot(dt, aes(x=`Biden Electoral Votes`, y=`Relative Likelihood`, fill=category))+
  geom_col()+
  scale_fill_manual(values=c(
    "Trump Win"="#ee4444",
    "Biden Win"="#0077ee"
  ))+
  #geom_vline(xintercept = as.numeric(data[order(-density)][1,1]), linetype="dotted", color="#666666", size=1)+
  theme_bw()+
  theme(legend.position = "bottom")+
  scale_x_continuous(breaks=seq(0,400,5),expand = c(0,0), limits=c(min(dt$`Biden Electoral Votes`),max(dt$`Biden Electoral Votes`)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,0.25))+
  theme(axis.line = element_line(color='black'),
        plot.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())

date <- Sys.Date()
ggsave(paste0("electoral college ", date, ".png"))
