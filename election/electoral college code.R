library(data.table)
library(ggplot2)
library(ggdist)

data <- data.table(Trump = c(199, 208, 218, 205, 215, 224, 234, 195, 205, 214, 224, 211, 221, 230, 240, 199, 209, 218, 228, 215, 225, 234, 244, 205, 215, 224, 234, 221, 231, 240, 250, 219, 229, 238, 248, 235, 245, 254, 264, 225, 235, 244, 254, 241, 251, 260, 270, 229, 239, 248, 258, 245, 255, 264, 274, 235, 245, 254, 264, 251, 261, 270, 280, 205, 215, 224, 234, 221, 231, 240, 250, 211, 221, 230, 240, 227, 237, 246, 256, 215, 225, 234, 244, 231, 241, 250, 260, 221, 231, 240, 250, 237, 247, 256, 266, 235, 245, 254, 264, 251, 261, 270, 280, 241, 251, 260, 270, 257, 267, 276, 286, 245, 255, 264, 274, 261, 271, 280, 290, 251, 261, 270, 280, 267, 277, 286, 296, 210, 219, 229, 216, 226, 235, 245, 206, 216, 225, 235, 222, 232, 241, 251, 210, 220, 229, 239, 226, 236, 245, 255, 216, 226, 235, 245, 232, 242, 251, 261, 230, 240, 249, 259, 246, 256, 265, 275, 236, 246, 255, 265, 252, 262, 271, 281, 240, 250, 259, 269, 256, 266, 275, 285, 246, 256, 265, 275, 262, 272, 281, 291, 216, 226, 235, 245, 232, 242, 251, 261, 222, 232, 241, 251, 238, 248, 257, 267, 226, 236, 245, 255, 242, 252, 261, 271, 232, 242, 251, 261, 248, 258, 267, 277, 246, 256, 265, 275, 262, 272, 281, 291, 252, 262, 271, 281, 268, 278, 287, 297, 256, 266, 275, 285, 272, 282, 291, 301, 262, 272, 281, 291, 278, 288, 297, 307))
data$Biden <- 538 - data$Trump
data$category <- fifelse(data$Biden > 270, "Biden Win", "Trump Win")
data$Likelihood <- c(6.10959E-10, 5.19126E-09, 5.46031E-09, 2.31099E-08, 2.43076E-08, 2.06539E-07, 2.17244E-07, 1.17675E-08, 1.23774E-08, 1.0517E-07, 1.1062E-07, 4.68182E-07, 4.92446E-07, 4.18428E-06, 4.40113E-06, 7.5699E-10, 7.96222E-10, 6.76543E-09, 7.11606E-09, 3.01175E-08, 3.16784E-08, 2.69169E-07, 2.83119E-07, 1.53358E-08, 1.61306E-08, 1.37061E-07, 1.44164E-07, 6.1015E-07, 6.41772E-07, 5.45309E-06, 5.7357E-06, 1.10207E-08, 1.15919E-08, 9.84954E-08, 1.036E-07, 4.3847E-07, 4.61194E-07, 3.91873E-06, 4.12183E-06, 2.23269E-07, 2.3484E-07, 1.99542E-06, 2.09883E-06, 8.88295E-06, 9.34333E-06, 7.93895E-05, 8.35039E-05, 1.43626E-08, 1.51069E-08, 1.28362E-07, 1.35015E-07, 5.71429E-07, 6.01044E-07, 5.10702E-06, 5.3717E-06, 2.90971E-07, 3.06051E-07, 2.60049E-06, 2.73527E-06, 1.15766E-05, 1.21765E-05, 0.000103463, 0.000108825, 1.06255E-08, 1.11762E-08, 9.49634E-08, 9.9885E-08, 4.22747E-07, 4.44656E-07, 3.77821E-06, 3.97402E-06, 2.15262E-07, 2.26419E-07, 1.92386E-06, 2.02357E-06, 8.56442E-06, 9.00828E-06, 7.65426E-05, 8.05096E-05, 1.38476E-08, 1.45652E-08, 1.23759E-07, 1.30174E-07, 5.50938E-07, 5.79491E-07, 4.92389E-06, 5.17908E-06, 2.80537E-07, 2.95076E-07, 2.50724E-06, 2.63718E-06, 1.11614E-05, 1.17399E-05, 9.97529E-05, 0.000104923, 2.01601E-07, 2.1205E-07, 1.80177E-06, 1.89515E-06, 8.0209E-06, 8.4366E-06, 7.16851E-05, 7.54002E-05, 4.08424E-06, 4.29591E-06, 3.6502E-05, 3.83937E-05, 0.000162495, 0.000170917, 0.001452266, 0.001527531, 2.62734E-07, 2.7635E-07, 2.34812E-06, 2.46982E-06, 1.04531E-05, 1.09949E-05, 9.34223E-05, 9.82641E-05, 5.32271E-06, 5.59857E-06, 4.75706E-05, 5.0036E-05, 0.000211769, 0.000222744, 0.001892641, 0.00199073, 6.64234E-08, 5.64394E-07, 5.93645E-07, 2.5125E-06, 2.64272E-06, 2.2455E-05, 2.36187E-05, 1.27937E-06, 1.34567E-06, 1.1434E-05, 1.20266E-05, 5.09007E-05, 5.35387E-05, 0.000454914, 0.000478491, 8.22999E-08, 8.65652E-08, 7.35537E-07, 7.73658E-07, 3.27438E-06, 3.44408E-06, 2.9264E-05, 3.07807E-05, 1.66731E-06, 1.75372E-06, 1.49012E-05, 1.56735E-05, 6.63355E-05, 6.97735E-05, 0.000592859, 0.000623585, 1.19817E-06, 1.26027E-06, 1.07084E-05, 1.12634E-05, 4.76705E-05, 5.0141E-05, 0.000426044, 0.000448125, 2.42738E-05, 2.55318E-05, 0.000216941, 0.000228185, 0.000965754, 0.001015806, 0.00863122, 0.009078546, 1.5615E-06, 1.64243E-06, 1.39556E-05, 1.46788E-05, 6.21257E-05, 6.53455E-05, 0.000555235, 0.000584011, 3.16344E-05, 3.32739E-05, 0.000282725, 0.000297378, 0.001258603, 0.001323832, 0.011248493, 0.011831463, 1.15521E-06, 1.21508E-06, 1.03244E-05, 1.08595E-05, 4.5961E-05, 4.8343E-05, 0.000410767, 0.000432055, 2.34033E-05, 2.46162E-05, 0.000209162, 0.000220002, 0.000931123, 0.00097938, 0.008321713, 0.008752998, 1.50551E-06, 1.58353E-06, 1.34551E-05, 1.41525E-05, 5.9898E-05, 6.30023E-05, 0.000535325, 0.000563069, 3.05E-05, 3.20807E-05, 0.000272587, 0.000286714, 0.001213471, 0.001276361, 0.010845133, 0.011407198, 2.19181E-05, 2.3054E-05, 0.000195888, 0.00020604, 0.000872032, 0.000917226, 0.007793596, 0.008197511, 0.000444038, 0.000467051, 0.003968494, 0.004174167, 0.017666474, 0.018582065, 0.157890259, 0.16607316, 2.85644E-05, 3.00448E-05, 0.000255288, 0.000268519, 0.001136461, 0.00119536, 0.010156874, 0.010683269, 0.000578685, 0.000608676, 0.005171873, 0.005439913, 0.023023536, 0.024216765, 0.205767837, 0.216432067)
  
dt <- dcast(data, Biden~., sum, value.var = "Likelihood")
colnames(dt) <- c("Biden Electoral Votes", "Relative Likelihood")
dt$`Relative Likelihood` <- dt$`Relative Likelihood`
dt$category <- fifelse(dt$`Biden Electoral Votes` > 270, "Biden Win", "Trump Win")

ggplot(dt, aes(x=`Biden Electoral Votes`, y=`Relative Likelihood`, fill=category))+
  geom_col()+
  scale_fill_manual(values=c(
    "Trump Win"="#ee4444",
    "Biden Win"="#0077ee"
  ))+
  #geom_vline(xintercept = as.numeric(data[order(-density)][1,1]), linetype="dotted", color="#666666", size=1)+
  theme_bw()+
  theme(legend.position = "bottom")+
  scale_x_continuous(breaks=seq(0,400,5),expand = c(0,0), limits=c(min(dt$`Biden Electoral Votes`),max(dt$`Biden Electoral Votes`)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,0.25))+
  theme(axis.line = element_line(color='black'),
        plot.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())

date <- Sys.Date()
ggsave(paste0("electoral college ", date, ".png"))
