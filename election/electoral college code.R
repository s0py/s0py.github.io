library(data.table)
library(ggplot2)
library(ggdist)

data <- data.table(Trump = c(199, 208, 218, 205, 215, 224, 234, 195, 205, 214, 224, 211, 221, 230, 240, 199, 209, 218, 228, 215, 225, 234, 244, 205, 215, 224, 234, 221, 231, 240, 250, 219, 229, 238, 248, 235, 245, 254, 264, 225, 235, 244, 254, 241, 251, 260, 270, 229, 239, 248, 258, 245, 255, 264, 274, 235, 245, 254, 264, 251, 261, 270, 280, 205, 215, 224, 234, 221, 231, 240, 250, 211, 221, 230, 240, 227, 237, 246, 256, 215, 225, 234, 244, 231, 241, 250, 260, 221, 231, 240, 250, 237, 247, 256, 266, 235, 245, 254, 264, 251, 261, 270, 280, 241, 251, 260, 270, 257, 267, 276, 286, 245, 255, 264, 274, 261, 271, 280, 290, 251, 261, 270, 280, 267, 277, 286, 296, 210, 219, 229, 216, 226, 235, 245, 206, 216, 225, 235, 222, 232, 241, 251, 210, 220, 229, 239, 226, 236, 245, 255, 216, 226, 235, 245, 232, 242, 251, 261, 230, 240, 249, 259, 246, 256, 265, 275, 236, 246, 255, 265, 252, 262, 271, 281, 240, 250, 259, 269, 256, 266, 275, 285, 246, 256, 265, 275, 262, 272, 281, 291, 216, 226, 235, 245, 232, 242, 251, 261, 222, 232, 241, 251, 238, 248, 257, 267, 226, 236, 245, 255, 242, 252, 261, 271, 232, 242, 251, 261, 248, 258, 267, 277, 246, 256, 265, 275, 262, 272, 281, 291, 252, 262, 271, 281, 268, 278, 287, 297, 256, 266, 275, 285, 272, 282, 291, 301, 262, 272, 281, 291, 278, 288, 297, 307))
data$Biden <- 538 - data$Trump
data$category <- fifelse(data$Biden > 270, "Biden Win", "Trump Win")
data$Likelihood <- c(3.12888E-08, 1.76033E-07, 1.83236E-07, 5.34007E-07, 5.55856E-07, 3.1273E-06, 3.25525E-06, 2.44202E-07, 2.54193E-07, 1.43011E-06, 1.48863E-06, 4.33833E-06, 4.51584E-06, 2.54065E-05, 2.6446E-05, 5.65784E-08, 5.88933E-08, 3.31339E-07, 3.44896E-07, 1.00514E-06, 1.04626E-06, 5.88636E-06, 6.1272E-06, 4.59649E-07, 4.78456E-07, 2.69183E-06, 2.80197E-06, 8.16583E-06, 8.49994E-06, 4.78214E-05, 4.97781E-05, 3.0302E-07, 3.15418E-07, 1.77457E-06, 1.84718E-06, 5.38326E-06, 5.60352E-06, 3.15259E-05, 3.28158E-05, 2.46177E-06, 2.56249E-06, 1.44168E-05, 1.50067E-05, 4.37342E-05, 4.55236E-05, 0.00025612, 0.000266599, 5.7036E-07, 5.93696E-07, 3.34019E-06, 3.47685E-06, 1.01326E-05, 1.05472E-05, 5.93396E-05, 6.17676E-05, 4.63366E-06, 4.82326E-06, 2.71361E-05, 2.82464E-05, 8.23187E-05, 8.56869E-05, 0.000482082, 0.000501807, 2.93912E-07, 3.05938E-07, 1.72123E-06, 1.79166E-06, 5.22145E-06, 5.43509E-06, 3.05783E-05, 3.18294E-05, 2.38777E-06, 2.48547E-06, 1.39835E-05, 1.45556E-05, 4.24196E-05, 4.41553E-05, 0.000248421, 0.000258586, 5.53216E-07, 5.75851E-07, 3.23979E-06, 3.37235E-06, 9.82808E-06, 1.02302E-05, 5.7556E-05, 5.9911E-05, 4.49439E-06, 4.67828E-06, 2.63204E-05, 2.73973E-05, 7.98444E-05, 8.31113E-05, 0.000467591, 0.000486723, 2.96289E-06, 3.08412E-06, 1.73515E-05, 1.80615E-05, 5.26368E-05, 5.47905E-05, 0.000308256, 0.000320869, 2.40708E-05, 2.50557E-05, 0.000140966, 0.000146733, 0.000427627, 0.000445124, 0.002504305, 0.002606771, 5.5769E-06, 5.80509E-06, 3.26599E-05, 3.39962E-05, 9.90757E-05, 0.000103129, 0.000580215, 0.000603955, 4.53074E-05, 4.71612E-05, 0.000265333, 0.000276189, 0.000804902, 0.000837835, 0.004713731, 0.004906599, 1.23087E-06, 6.92501E-06, 7.20835E-06, 2.10074E-05, 2.18669E-05, 0.000123025, 0.000128059, 9.60669E-06, 9.99976E-06, 5.62595E-05, 5.85614E-05, 0.000170666, 0.000177649, 0.00099947, 0.001040365, 2.22575E-06, 2.31682E-06, 1.30346E-05, 1.35679E-05, 3.95412E-05, 4.11591E-05, 0.000231564, 0.000241039, 1.80822E-05, 1.88221E-05, 0.000105895, 0.000110227, 0.000321237, 0.000334381, 0.001881255, 0.001958228, 1.19206E-05, 1.24083E-05, 6.98101E-05, 7.26665E-05, 0.000211773, 0.000220438, 0.001240202, 0.001290946, 9.68439E-05, 0.000100806, 0.000567145, 0.000590351, 0.001720466, 0.001790861, 0.010075538, 0.010487789, 2.24375E-05, 2.33555E-05, 0.0001314, 0.000136777, 0.00039861, 0.000414919, 0.002334372, 0.002429885, 0.000182285, 0.000189743, 0.00106751, 0.001111188, 0.00323835, 0.00337085, 0.018964696, 0.019740656, 1.15622E-05, 1.20353E-05, 6.77118E-05, 7.04823E-05, 0.000205407, 0.000213812, 0.001202925, 0.001252143, 9.3933E-05, 9.77763E-05, 0.000550098, 0.000572606, 0.001668753, 0.001737032, 0.009772691, 0.010172551, 2.17631E-05, 2.26535E-05, 0.000127451, 0.000132665, 0.000386629, 0.000402448, 0.002264206, 0.002356849, 0.000176805, 0.00018404, 0.001035423, 0.001077788, 0.003141013, 0.003269531, 0.018394662, 0.019147299, 0.000116558, 0.000121327, 0.000682594, 0.000710523, 0.002070687, 0.002155412, 0.012126533, 0.012622703, 0.000946927, 0.000985671, 0.005545471, 0.00577237, 0.016822492, 0.017510802, 0.098517285, 0.102548225, 0.000219391, 0.000228367, 0.001284814, 0.001337384, 0.003897554, 0.004057027, 0.022825184, 0.0237591, 0.001782354, 0.001855281, 0.010437971, 0.010865052, 0.03166416, 0.032959733, 0.185434302, 0.193021543)
  
  
dt <- dcast(data, Biden~., sum, value.var = "Likelihood")
colnames(dt) <- c("Biden Electoral Votes", "Relative Likelihood")
dt$`Relative Likelihood` <- dt$`Relative Likelihood`
dt$category <- fifelse(dt$`Biden Electoral Votes` > 270, "Biden Win", "Trump Win")

ggplot(dt, aes(x=`Biden Electoral Votes`, y=`Relative Likelihood`, fill=category))+
  geom_col()+
  scale_fill_manual(values=c(
    "Trump Win"="#ee4444",
    "Biden Win"="#0077ee"
  ))+
  #geom_vline(xintercept = as.numeric(data[order(-density)][1,1]), linetype="dotted", color="#666666", size=1)+
  theme_bw()+
  theme(legend.position = "bottom")+
  scale_x_continuous(breaks=seq(0,400,5),expand = c(0,0), limits=c(min(dt$`Biden Electoral Votes`),max(dt$`Biden Electoral Votes`)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,0.25))+
  theme(axis.line = element_line(color='black'),
        plot.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())

date <- Sys.Date()
ggsave(paste0("electoral college ", date, ".png"))
